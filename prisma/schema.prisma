generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model
model Penduduk {
  nik                 String       @id @unique @db.VarChar(16)
  noKK                String       @db.VarChar(16)
  nama                String       @db.VarChar(255)
  tempatLahir         String       @map("tempat_lahir") @db.VarChar(128)
  tanggalLahir        DateTime     @map("tanggal_lahir") @db.Date()
  jenisKelamin        JenisKelamin @map("jenis_kelamin")
  agama               String       @db.VarChar(30)
  alamat              String       @db.VarChar(128)
  rt                  String       @db.VarChar(3)
  rw                  String       @db.VarChar(3)
  desa                String       @db.VarChar(128)
  kecamatan           String       @db.VarChar(128)
  kotaKabupaten       String       @map("kota_kabupaten") @db.VarChar(128)
  provinsi            String       @db.VarChar(128)
  pendidikanTerakhir  String       @map("pendidikan_terakhir") @db.VarChar(30)
  pendidikanDitempuh  String?      @map("pendidikan_ditempuh") @db.VarChar(30)
  pekerjaan           String       @db.VarChar(30)
  statusPerkawinan    String       @map("status_perkawinan") @db.VarChar(30)
  statusDalamKeluarga String       @map("status_dalam_keluarga") @db.VarChar(30)
  kewarganegaraan     String       @db.VarChar(30)
  namaAyah            String       @map("nama_ayah") @db.VarChar(255)
  namaIbu             String       @map("nama_ibu") @db.VarChar(255)
  dibuatPada          DateTime     @default(now()) @map("dibuat_pada")
  diubahPada          DateTime     @updatedAt @map("diubah_pada")

  aparatDesa AparatDesa?
  user       User?

  @@map("penduduk")
}

model AparatDesa {
  id         Int      @id @default(autoincrement())
  nik        String   @unique @db.VarChar(16)
  nama       String   @db.VarChar(255)
  jabatan    String   @db.VarChar(30)
  dibuatPada DateTime @default(now()) @map("dibuat_pada")
  diubahPada DateTime @updatedAt @map("diubah_pada")

  penduduk Penduduk @relation(fields: [nik], references: [nik], onUpdate: Cascade, onDelete: Cascade)
  admin    Admin?

  @@map("aparat_desa")
}

model User {
  id           Int      @id @default(autoincrement())
  nik          String   @unique @db.VarChar(16)
  pin          String   @db.VarChar()
  nama         String   @db.VarChar(255)
  dibuatPada   DateTime @default(now()) @map("dibuat_pada")
  diubahPada   DateTime @updatedAt @map("diubah_pada")
  pertamaLogin Boolean  @default(true) @map("pertama_login")

  penduduk Penduduk @relation(fields: [nik], references: [nik], onUpdate: Cascade, onDelete: Cascade)

  @@map("user")
}

model Admin {
  id           Int      @id @default(autoincrement())
  username     String   @unique @db.VarChar(30)
  password     String   @db.VarChar()
  nama         String   @db.VarChar(255)
  dibuatPada   DateTime @default(now()) @map("dibuat_pada")
  diubahPada   DateTime @updatedAt @map("diubah_pada")
  aparatDesaId Int?     @unique @map("aparat_desa_id")

  aparatDesa AparatDesa? @relation(fields: [aparatDesaId], references: [id], onUpdate: Cascade, onDelete: Cascade)

  @@map("admin")
}

model JenisSurat {
  id   Int    @id @default(autoincrement())
  nama String @unique @db.VarChar(255)
  kode String @unique @db.VarChar(5)

  surat Surat[]

  @@map("jenis_surat")
}

model Surat {
  id               Int      @id @default(autoincrement())
  nomorSurat       String   @unique @map("nomor_surat") @db.VarChar(30)
  nikPemohon       String   @map("nik_pemohon") @db.VarChar(16)
  keperluan        String   @db.Text()
  keterangan       String   @db.Text()
  dataTambahan     Json?    @map("data_tambahan")
  tanggalPengajuan DateTime @default(now()) @map("tanggal_pengajuan") @db.Date
  berlakuHingga    DateTime @map("berlaku_hingga") @db.Date
  jenisSuratId     Int      @map("jenis_surat_id")

  permohonan PermohonanSurat?

  jenisSurat JenisSurat @relation(fields: [jenisSuratId], references: [id])

  @@map("surat")
}

model PermohonanSurat {
  id               Int              @id @default(autoincrement())
  idSurat          Int              @unique
  status           StatusPermohonan
  tanggalPengajuan DateTime         @default(now())

  surat Surat @relation(fields: [idSurat], references: [id])

  @@map("permohonan_surat")
}

// Enum
enum JenisKelamin {
  L
  P

  @@map("jenis_kelamin")
}

enum StatusPermohonan {
  Dikirim
  Diterima
  Ditolak
  Selesai

  @@map("status_permohonan")
}
